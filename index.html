<html>
	<head>
		<title>Airplane</title>
		<style type="text/css">

* {
	margin: 0;
	padding: 0;
	line-height: 0;
}
html {
	background-color: black;
}
#score {
	position: absolute;
	top: 20;
	font-family: monospace;
	font-size: 20px;
	left: 80;
	color: white;
}
/* personal assets obtained from https://kenney.nl/assets/topdown-tanks-redux */
#game {
	background-color: white;
	position: absolute;
	top: 40;
	left: 80;
}
#ocean {
	background-image: url("img/ocean.jpg");
	background-size: contain;
}
#player {
	position: absolute;
	background-image: url("img/player.png");
	background-size: cover;
}
.enemy {
	position: absolute;
	background-image: url("img/enemy.png");
	background-size:cover;
}

		</style>
	</head>
	<body>
		<div id="game">
			<div id="ocean"></div>
			<div id="players">
				<div id="player" class="tile"></div>
			</div>
			<div id="enemies">
				<div class="enemy tile"></div>
			</div>
		</div>
		<div id="score">: Score 0 : Lives 3 :</div>
		<script type="text/javascript">

const PERSONAL_GRAPHICS = true;
const MARGIN = 40;
const scaleFactor = 1.8; //larger number scales images down more. I prefer 1.8 - 2.4
const xTiles = 9*scaleFactor; //multiple of nine
const yTiles = 7*scaleFactor; //multiple of seven
var tileSize = 10;
var gameWidth = 900, gameHeight = 700;
var gameCornerX = 0, gameCornerY = 0;

function alignGame() {
	var screenHeight = window.innerHeight;
	var screenWidth = window.innerWidth;
	if (screenWidth*9<screenHeight*7) {
		gameWidth = screenWidth - 2*MARGIN;
		gameHeight = gameWidth*7/9;
	} else {
		gameHeight = screenHeight - 2*MARGIN;
		gameWidth = gameHeight*9/7;
	}
	if (screenWidth*9<screenHeight*7) {
		var marginVal = Math.floor((screenHeight - gameHeight)/2);
		gameCornerX = MARGIN;
		gameCornerY = marginVal;
	} else {
		var marginVal = Math.floor((screenWidth - gameWidth)/2);
		gameCornerX = marginVal;
		gameCornerY = MARGIN;
	}
	document.getElementById("game").style.left = gameCornerX + "px";
	document.getElementById("game").style.top = gameCornerY + "px";
	document.getElementById("score").style.left = gameCornerX + "px";
	document.getElementById("game").style.width = gameWidth + "px";
	document.getElementById("game").style.height = gameHeight + "px";
	document.getElementById("ocean").style.width = gameWidth + "px";
	document.getElementById("ocean").style.height = gameHeight + "px";
	tileSize = Math.floor(Math.min(gameWidth/xTiles, gameHeight/yTiles));
	updateAssets();
}
alignGame(); //Run once when the window is loaded. This is a code snippet from my Ninja Man Project located here : https://github.com/Luke-Draper/CodingDojo-NinjaManProject

function updateAssets() {
	if (PERSONAL_GRAPHICS) {
		document.getElementById("ocean").style.backgroundImage = 'url("img/tileGrass1.png")';
		document.getElementById("ocean").style.backgroundSize = 'auto';
	}
}
function updateTiles() {
	var all = document.getElementsByClassName('tile');
	for (var i = 0; i < all.length; i++) {
		all[i].style.width = tileSize + "px";
		all[i].style.height = tileSize + "px";
	}
}

function drawPlanes() {
	drawPlayer();
	drawEnemies();
	updateTiles();
}
function drawPlayer() {
	document.getElementById("player").style.left = (player.left - tileSize/2) + "px";
	document.getElementById("player").style.top = player.top + "px";
	if (PERSONAL_GRAPHICS) {
		document.getElementById("player").style.backgroundImage = 'url("img/tank_blue.png")';
	}
}
function drawEnemies() {
	createEnemyElements();
	var docEnemies = document.getElementsByClassName('enemy');
	if (docEnemies.length != enemies.length) {
		console.log("Enemy array mismatch");
	}
	for (var i = 0; i < Math.min(docEnemies.length, enemies.length); i++) {
		docEnemies[i].style.left = (enemies[i].left - tileSize/2) + "px";
		docEnemies[i].style.top = enemies[i].top + "px";
		if (PERSONAL_GRAPHICS) {
			docEnemies[i].style.backgroundImage = 'url("img/tank_dark.png")';
		}
	}
}
function createEnemyElements() {
	var htmlOutput = "";
	for (var i=0; i<enemies.length; i++) {
		htmlOutput += "<div class='enemy tile'></div>";
	}
	document.getElementById("enemies").innerHTML = htmlOutput;
}

var upPressed = false;
var downPressed = false;
var leftPressed = false;
var rightPressed = false;

var player = {
	left: gameWidth/2,
	top: gameHeight*2/3
}

var enemies  = [
	{left: gameWidth/3, top: gameHeight/3},
	{left: gameWidth/6, top: gameHeight/6},
	{left: gameWidth*2/3, top: gameHeight/3},
	{left: gameWidth*5/6, top: gameHeight/6}
];

drawPlanes();

document.onkeydown = function(e) {
	if(e.keyCode == 37) { // LEFT
		leftPressed = true;
	}
	if (e.keyCode == 39) { // RIGHT
		rightPressed = true;
	}
	if (e.keyCode == 38) { // UP
		upPressed = true;
	}
	if (e.keyCode == 40) { // DOWN
		downPressed = true;
	}
}
document.onkeyup = function(e) {
	if(e.keyCode == 37) { // LEFT
		leftPressed = false;
	}
	if (e.keyCode == 39) { // RIGHT
		rightPressed = false;
	}
	if (e.keyCode == 38) { // UP
		upPressed = false;
	}
	if (e.keyCode == 40) { // DOWN
		downPressed = false;
	}
}

var timer = null;
const GAME_TICK_TIME = 10;

timer = window.setInterval(gameTick, GAME_TICK_TIME);

function gameTick() {
	playerTick();
	drawPlanes();
}
function playerTick() {
	var skew = 0, scale = 1;
	if(leftPressed && !(leftPressed && rightPressed)) { // LEFT
		if (player.left > tileSize/2) {
			player.left--;
		}
		skew = 0.1;
	}
	if (rightPressed && !(leftPressed && rightPressed)) { // RIGHT
		if (player.left < gameWidth-tileSize/2) {
			player.left++;
		}
		skew = -0.1;
	}
	if (upPressed && !(upPressed && downPressed)) { // UP
		if (player.top > gameHeight/2+tileSize) {
			player.top--;
		}
		if (!PERSONAL_GRAPHICS) {
			scale = 1.1;
		}
	}
	if (downPressed && !(upPressed && downPressed)) { // DOWN
		if (player.top < gameHeight-(tileSize+5)) {
			player.top++;
		}
		if (!PERSONAL_GRAPHICS) {
			scale = 0.9;
		}
	}
	document.getElementById("player").style.transform = "matrix(1, " + -skew + ", " + skew + ", " + scale + ", 0, 0)";
}


		</script>
	</body>
</html>