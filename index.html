<html>
	<head>
		<title>Airplane</title>
		<style type="text/css">

* {
	margin: 0;
	padding: 0;
	line-height: 0;
}
html {
	background-color: black;
}
#score-container {
	background-color: black;
	position: absolute;
	top: 0;
}
#score {
	position: absolute;
	top: 30;
	font-family: monospace;
	font-size: 20px;
	color: white;
	text-align: center;
}
#help-container {
	background-color: black;
	position: absolute;
	top: 0;
}
#help {
	position: absolute;
	top: 30;
	font-family: monospace;
	font-size: 20px;
	color: white;
	text-align: center;
}
/* personal assets obtained from https://kenney.nl/assets/topdown-tanks-redux */
#game {
	background-color: white;
	position: absolute;
	top: 40;
	left: 80;
}
#ocean {
	background-image: url("img/ocean.jpg");
	background-size: contain;
}
#player {
	position: absolute;
	background-image: url("img/player.png");
	background-size: cover;
}
.enemy {
	position: absolute;
	background-image: url("img/enemy.png");
	background-size:cover;
}

		</style>
	</head>
	<body>
		<div id="game">
			<div id="ocean"></div>
			<div id="players">
				<div id="player" class="tile"></div>
			</div>
			<div id="enemies">
				<div class="enemy tile"></div>
			</div>
			<div id="bullets"></div>
			<div id="missiles"></div>
			<div id="pickups"></div>
		</div>
		<div id="score-container">
			<div id="score">: Highscore &bull; 2000 : Score &bull; 0 : Health &bull; 100 : Missiles &bull; 5 :</div>
		</div>
		<div id="help-container">
			<div id="help">: Move &bull; ← → ↑ ↓ : Shoot &bull; Space : Missile &bull; X :</div>
		</div>
		<script type="text/javascript">

/* Settings */

const PERSONAL_GRAPHICS = true;
const SCALE_FACTOR = 1.8; //larger number scales images down more. I prefer 1.8 - 2.4
const GAME_TICK_TIME = 4;
const GAME_START_DELAY = 200;
const PLAYER_SPEED = 2;
const PLAYER_STARTING_HEALTH = 100;
const PLAYER_INVULNERABILITY_TIME = 50;
const PLAYER_BULLET_FIRING_RATE = 5; //Number of ticks before the next bullet can be fired
const PLAYER_BULLET_DAMAGE = 5;
const PLAYER_BULLET_SPEED = 4;
const PLAYER_STARTING_MISSILES = 5;
const PLAYER_MISSILE_FIRING_RATE = 25; //Number of ticks before the next bullet can be fired
const PLAYER_MISSILE_DAMAGE = 30;
const PLAYER_MISSILE_SPEED = 8;
const ENEMY_SPAWN_RATE = 500;
const ENEMY_SPAWN_FIRING_DELAY = 25;
const ENEMY_STARTING_HEALTH = 20;
const ENEMY_BULLET_FIRING_RATE = 5; //Number of ticks before the next bullet is fired
const ENEMY_BULLET_DAMAGE = 3;
const ENEMY_BULLET_SPEED = 4;
const STARTING_ENEMIES = 3;

/* Constants */

const MARGIN = 60;
const xTiles = 9*SCALE_FACTOR; //multiple of nine
const yTiles = 7*SCALE_FACTOR; //multiple of seven

/* Variables */

var score = 0;
var highscore = 2000;
var tileSize = 10;
var gameWidth = 900, gameHeight = 700;
var gameCornerX = 0, gameCornerY = 0;
var upPressed = false;
var downPressed = false;
var leftPressed = false;
var rightPressed = false;
var bulletPressed = false;
var missilePressed = false;
var player = {
	left: gameWidth/2,
	top: gameHeight*2/3,
	moveTimer: 0,
	bulletTimer: 0,
	missileTimer: 0,
	isInvulnerable: false,
	invulnerabilityTimer: 0,
	health: PLAYER_STARTING_HEALTH,
	missiles: PLAYER_STARTING_MISSILES
}
var enemyArray  = [
	{left: gameWidth/3, top: gameHeight/3, bulletTimer: 0, health: 20},
	{left: gameWidth/6, top: gameHeight/6},
	{left: gameWidth*2/3, top: gameHeight/3},
	{left: gameWidth*5/6, top: gameHeight/6}
];
var enemySpawnTimer = 0;
var bulletArray = [
	{left: 0, top: 0, speed: 2, damage: 3}
];
var missileArray = [
	{left: 0, top: 0, speed: 2, damage: 3}
];
var pickupArray = [
	{left: 0, top: 0, speed: 1, type: 'health', amount: 5}
];
var gameTime = 0;
var timer = null;

/* Setup Functions */

function alignGame() {
	var screenHeight = window.innerHeight;
	var screenWidth = window.innerWidth;
	if (screenWidth*9<screenHeight*7) {
		gameWidth = screenWidth - 2*MARGIN;
		gameHeight = gameWidth*7/9;
	} else {
		gameHeight = screenHeight - 2*MARGIN;
		gameWidth = gameHeight*9/7;
	}
	if (screenWidth*9<screenHeight*7) {
		var marginVal = Math.floor((screenHeight - gameHeight)/2);
		gameCornerX = MARGIN;
		gameCornerY = marginVal;
	} else {
		var marginVal = Math.floor((screenWidth - gameWidth)/2);
		gameCornerX = marginVal;
		gameCornerY = MARGIN;
	}
	document.getElementById("game").style.left = gameCornerX + "px";
	document.getElementById("game").style.top = gameCornerY + "px";
	document.getElementById("score-container").style.left = gameCornerX + "px";
	document.getElementById("score-container").style.width = gameWidth + "px";
	document.getElementById("score-container").style.height = gameCornerY + "px";
	document.getElementById("score").style.width = gameWidth + "px";
	document.getElementById("score").style.height = gameCornerY + "px";
	document.getElementById("score").style.top = gameCornerY/2 + "px";
	document.getElementById("help-container").style.left = gameCornerX + "px";
	document.getElementById("help-container").style.width = gameWidth + "px";
	document.getElementById("help-container").style.height = gameCornerY + "px";
	document.getElementById("help-container").style.top = (gameCornerY + gameHeight) + "px";
	document.getElementById("help").style.width = gameWidth + "px";
	document.getElementById("help").style.height = gameCornerY/2 + "px";
	document.getElementById("help").style.top = gameCornerY/2 + "px";
	document.getElementById("game").style.width = gameWidth + "px";
	document.getElementById("game").style.height = gameHeight + "px";
	document.getElementById("ocean").style.width = gameWidth + "px";
	document.getElementById("ocean").style.height = gameHeight + "px";
	document.getElementById("score").style.height = gameCornerY + "px";
	tileSize = Math.floor(Math.min(gameWidth/xTiles, gameHeight/yTiles));
	updateGround();
}
alignGame(); //Run once when the window is loaded. This is a code snippet from my Ninja Man Project located here : https://github.com/Luke-Draper/CodingDojo-NinjaManProject
function updateGround() {
	if (PERSONAL_GRAPHICS) {
		document.getElementById("ocean").style.backgroundImage = 'url("img/tileGrass1.png")';
		document.getElementById("ocean").style.backgroundSize = 'auto';
	}
}

function initializeGame() {
	if (timer != null) {
		window.clearInterval(timer);
		timer = null;
	}
	resetGame();
	for (var i=0; i<STARTING_ENEMIES; i++) {
		spawnEnemy();
	}
	timer = window.setInterval(gameTick, GAME_TICK_TIME);
}
function resetGame() {
	gameTime = 0;
	score = 0;
	player = {
		left: gameWidth/2,
		top: gameHeight*2/3,
		moveTimer: 0,
		bulletTimer: 0,
		missileTimer: 0,
		isInvulnerable: false,
		invulnerabilityTimer: 0,
		health: PLAYER_STARTING_HEALTH,
		missiles: PLAYER_STARTING_MISSILES
	}
	enemyArray  = [];
	enemySpawnTimer = 0;
	bulletArray = [];
	missileArray = [];
	pickupArray = [];
}


/* Display Functions */

function drawPlanes() {
	drawPlayer();
	drawEnemies();
	updateTiles();
	drawBullets();
	drawMissiles();
	drawPickups();
}
function drawPlayer() {
	document.getElementById("player").style.left = (player.left - tileSize/2) + "px";
	document.getElementById("player").style.top = player.top + "px";
	if (PERSONAL_GRAPHICS) {
		document.getElementById("player").style.backgroundImage = 'url("img/tank_blue.png")';
	}
}
function drawEnemies() {
	createEnemyElements();
	var docEnemies = document.getElementsByClassName('enemy');
	if (docEnemies.length != enemyArray.length) {
		console.log("Enemy array mismatch");
	}
	for (var i = 0; i < Math.min(docEnemies.length, enemyArray.length); i++) {
		docEnemies[i].style.left = (enemyArray[i].left - tileSize/2) + "px";
		docEnemies[i].style.top = enemyArray[i].top + "px";
		if (PERSONAL_GRAPHICS) {
			docEnemies[i].style.backgroundImage = 'url("img/tank_dark.png")';
		}
	}
}
function createEnemyElements() {
	var htmlOutput = "";
	for (var i=0; i<enemyArray.length; i++) {
		htmlOutput += "<div class='enemy tile'></div>";
	}
	document.getElementById("enemies").innerHTML = htmlOutput;
}
function updateTiles() {
	var all = document.getElementsByClassName('tile');
	for (var i = 0; i < all.length; i++) {
		all[i].style.width = tileSize + "px";
		all[i].style.height = tileSize + "px";
	}
}
function drawBullets() {
	//TODO
}
function drawMissiles() {
	//TODO
}
function drawPickups() {
	//TODO
}

/* Interaction Functions */

document.onkeydown = function(e) {
	if(e.keyCode == 37) { // LEFT
		leftPressed = true;
	}
	if (e.keyCode == 39) { // RIGHT
		rightPressed = true;
	}
	if (e.keyCode == 38) { // UP
		upPressed = true;
	}
	if (e.keyCode == 40) { // DOWN
		downPressed = true;
	}
	if (e.keyCode == 32) { // SPACE - Fire Bullet
		bulletPressed = true;
	}
	if (e.keyCode == 88) { // X - Fire Missile
		missilePressed = true;
	}
}
document.onkeyup = function(e) {
	if(e.keyCode == 37) { // LEFT
		leftPressed = false;
	}
	if (e.keyCode == 39) { // RIGHT
		rightPressed = false;
	}
	if (e.keyCode == 38) { // UP
		upPressed = false;
	}
	if (e.keyCode == 40) { // DOWN
		downPressed = false;
	}
	if (e.keyCode == 32) { // SPACE - Fire Bullet
		bulletPressed = false;
	}
	if (e.keyCode == 88) { // X - Fire Missile
		missilePressed = false;
	}
}

/* Game Loop Functions */

function gameTick() {
	if (gameTime >= GAME_START_DELAY) {
		playerTick();
	}
	drawPlanes();
	scoreBoard();
	gameTime++;
}
function playerTick() {
	if (player.moveTimer>=PLAYER_SPEED) {
		playerMove();
		player.moveTimer = 0;
	} else {
		player.moveTimer++;
	}
}
function playerMove() {
	var skew = 0, scale = 1;
	if(leftPressed && !(leftPressed && rightPressed)) { // LEFT
		if (player.left > tileSize/2) {
			player.left--;
		}
		skew = 0.1;
	}
	if (rightPressed && !(leftPressed && rightPressed)) { // RIGHT
		if (player.left < gameWidth-tileSize/2) {
			player.left++;
		}
		skew = -0.1;
	}
	if (upPressed && !(upPressed && downPressed)) { // UP
		if (player.top > gameHeight/2+tileSize) {
			player.top--;
		}
		if (!PERSONAL_GRAPHICS) {
			scale = 1.1;
		}
	}
	if (downPressed && !(upPressed && downPressed)) { // DOWN
		if (player.top < gameHeight-(tileSize+5)) {
			player.top++;
		}
		if (!PERSONAL_GRAPHICS) {
			scale = 0.9;
		}
	}
	document.getElementById("player").style.transform = "matrix(1, " + -skew + ", " + skew + ", " + scale + ", 0, 0)";
}
function playerFireBullet() {

}
function enemyTick() {

}


function scoreBoard() {
	if (score > highscore) {
		highscore = score;
	}
	document.getElementById("score").innerHTML = ": Highscore &bull; " + highscore + " : Score &bull; " + score + " : Health &bull; " + player.health + " : Missiles &bull; " + player.missiles + " :";
}
function spawnEnemy() {
	var l = Math.floor(tileSize/2 + (Math.random() * (gameWidth-tileSize)));
	var t = -Math.floor(tileSize + (Math.random() * 2 * tileSize));
	enemyArray.push({left: l, top: t, bulletTimer: -ENEMY_SPAWN_FIRING_DELAY, health: ENEMY_STARTING_HEALTH});
}
function spawnBullet(l, t, s, d) {
	bulletArray.push({left: l, top: t, speed: s, damage: d});
}
function spawnMissile(l, t, s, d) {
	missileArray.push({left: l, top: t, speed: s, damage: d});
}
function spawnPowerup(l, t, s, type, a) {
	missileArray.push({left: l, top: t, speed: s, type: type, amount: a});
}

initializeGame();

		</script>
	</body>
</html>